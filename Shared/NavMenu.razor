@using HCMIS.Interface;
@using HCMIS.SHARED.DTOs.Utilities;
@using System.Text.Json;
@inject IAuthenticationService AuthService;
@inject HttpClient Http;
@*@inject IAuthenticationService AccountService;*@

<MudDrawer @bind-Open="@SideBarOpen" Elevation="1" ClipMode="DrawerClipMode.Never" Style="margin-top:2px;">
    <MudDrawerHeader>
        <MudAvatar Color="Color.Transparent" Size="Size.Large">
            <ChildContent>
                <img src="/image/logonhcc.png" alt="Logo" style="width:85px; height:90px; margin-top:-2px;" />
            </ChildContent>
        </MudAvatar>
        <MudText Typo="Typo.h5" Color="Color.Primary" Style="margin: auto;background-color: lavenderblush;font-weight: bolder;">HCMIS</MudText>
    </MudDrawerHeader>
    <MudNavMenu>
        <MudNavLink Href="/DashboardPage" Match="NavLinkMatch.All" Icon="fa fa-tachometer">DASHBOARD</MudNavLink>
        @if (Credentials != null)
        {
            if (SystemUsersData != null)
            {
                //Show for only Head of Departments
                var hoddetail = SystemUsersData.FirstOrDefault(o => o.HoDemployeeId == Credentials.StaffId);

            if (Credentials.UserRole.Contains("SUPER ADMINISTRATOR", StringComparison.CurrentCultureIgnoreCase))
            {
                <MudNavGroup Title="HR" Icon="fa fa-users" Expanded="false">
                    <MudNavLink Href="/EmployeeRegistrationNewPage" Icon="fa fa-indent">EMPLOYEE REGISTRATION</MudNavLink>
                    <MudNavLink Href="/EmployeeExitsPage" Icon="fa fa-times-circle">SEPARATION OF SERVICE</MudNavLink>
                    <MudNavLink Href="/OrganisationStructurePage" Icon="fa fa-sitemap">ORGANISATION STRUCTURE</MudNavLink>
                    <MudNavLink Href="/AptitudeTestPage" Icon="fa fa-pencil">APTITUDE TEST</MudNavLink>
                    <MudNavLink Href="/DisciplinaryPage" Icon="fa fa-eye">DISCIPLINARY</MudNavLink>
                </MudNavGroup>
                <MudNavGroup Title="APPLICATION" Icon="fa fa-pencil-square" Expanded="false">
                    <MudNavLink Href="/SubmittedApplicationPage" Icon="fa fa-plus-circle">NEWLY SUBMITTED</MudNavLink>
                    <MudNavLink Href="/InterviewApplicationPage" Icon="fa fa-question-circle">ORAL INTERVIEWS</MudNavLink>
                    <MudNavLink Href="/FinalApplicationAssessmentPage" Icon="fa fa-list-alt">FINAL REVIEW</MudNavLink>
                </MudNavGroup>
                <MudNavGroup Title="EMPLOYEE" Icon="fa fa-user" Expanded="false">
                    <MudNavGroup Title="PERFORMANCE APPRAISAL" Icon="fa fa-weibo" Expanded="false">                        
                        <MudNavLink Href="/BscPerspectivesPage" Icon="fa fa-free-code-camp">SET PERSPECTIVE TOTAL WEIGHT</MudNavLink>
                        <MudNavLink Href="/BSCKeyPerformanceIndicatorsPage" Icon="fa fa-bullseye">SET TARGETS</MudNavLink>
                        <MudNavLink Href="/AppraisalFormPage" Icon="fa fa-street-view">APPRAISAL</MudNavLink>
                    </MudNavGroup>
                    <MudNavGroup Title="EMPLOYEE LEAVE" Icon="fa fa-university" Expanded="false">
                            <MudNavLink Href="/AnnualLeaveRosterPage" Icon="fa fa-calendar">ANNUAL LEAVE ROASTER</MudNavLink>
                        <MudNavLink Href="/EmployeeLeaveRequestPage" Icon="fa fa-pencil-square-o">LEAVE REQUEST</MudNavLink>
                    </MudNavGroup>
                    <MudNavGroup Title="LEARNING AND DEVELOPMENT" Icon="fa fa-exchange" Expanded="false">
                        <MudNavLink Href="/AssessmentSurveyPage" Icon="fa fa-assistive-listening-systems">ASSESSMENT SURVEY</MudNavLink>
                        <MudNavGroup Title="CPD" Icon="fa fa-eercast" Expanded="false">
                            <MudNavLink Href="/CPDPage" Icon="fa fa-snowflake-">CPD</MudNavLink>
                            <MudNavLink Href="/CPDSummaryPage" Icon="fa fa-bandcamp">CPD SUMMARY</MudNavLink>
                        </MudNavGroup>
                        <MudNavLink Href="/GeneralInternalPage" Icon="fa fa-certificate">TRAINING PLAN</MudNavLink>
                        <MudNavLink Href="/SubscriptionPage" Icon="fa fa-bolt">SUBSCRIPTION</MudNavLink>
                        <MudNavLink Href="/TrainingEvaluationFormPage" Icon="fa fa-bomb">TRAINING EVALUATION</MudNavLink>
                    </MudNavGroup>
                </MudNavGroup>

                <MudNavGroup Title="REPORTS" Icon="fa fa-file-excel-o" Expanded="false">
                    <MudNavLink Href="/AppraisalReport" Icon="fa fa-file-excel-o">APPRAISAL REPORT</MudNavLink>

                    <MudNavGroup Title="EMPLOYEE REPORTS" Icon="fa fa-file-excel-o" Expanded="false">
                            <MudNavLink Href="/EmployeeDetailsReportPage" Icon="fa fa-info-circle">EMPLOYEE DETAILS REPORT</MudNavLink>
                            <MudNavLink Href="/EmployeeFamilyReportPage" Icon="fa fa-life-ring">EMPLOYEE FAMILY REPORT</MudNavLink>
                            <MudNavLink Href="/EmployeeQualificationsReportPage" Icon="fa fa-graduation-cap">EMPLOYEE QUALIFICATIONS REPORT</MudNavLink>
                    </MudNavGroup>

                    <MudNavGroup Title="LEAVE REPORTS" Icon="fa fa-file-excel-o" Expanded="false">
                            <MudNavLink Href="/AnnualLeaveRoasterReport" Icon="fa fa-life-ring">LEAVE ROASTER REPORT</MudNavLink>
                            <MudNavLink Href="/LeaveRequestReportPage" Icon="fa fa-info-circle">LEAVE REQUEST REPORT</MudNavLink>                            
                    </MudNavGroup>
                </MudNavGroup>

                <MudNavGroup Title="UTILITIES" Icon="fa fa-cogs" Expanded="false">
                    <MudNavLink Href="/PrimaryDataPage" Icon="fa fa-database">PRIMARY DATA </MudNavLink>
                    <MudNavGroup Title="MANAGE USERS" Icon="fa fa-users" Expanded="false">
                        <MudNavLink Href="/AccountManagementPage" Icon="fa fa-user-plus">ACCOUNT MANAGEMENT</MudNavLink>
                        <MudNavLink Href="/PrimaryDataPage" Icon="fa fa-users">PRIMARY DATA</MudNavLink>
                    </MudNavGroup>
                </MudNavGroup>
            }

            else if (Credentials.UserRole.Contains("ADMINISTRATOR", StringComparison.CurrentCultureIgnoreCase))
            {
                <MudNavGroup Title="HR" Icon="fa fa-users" Expanded="false">
                    <MudNavLink Href="/EmployeeExitsPage" Icon="fa fa-times-circle">SEPARATION OF SERVICE</MudNavLink>
                    <MudNavLink Href="/OrganisationStructurePage" Icon="fa fa-sitemap">ORGANISATION STRUCTURE</MudNavLink>
                    <MudNavLink Href="/AptitudeTestPage" Icon="fa fa-pencil">APTITUDE TEST</MudNavLink>
                        <MudNavLink Href="/DisciplinaryPage" Icon="fa fa-eye">DISCIPLINARY</MudNavLink>
                </MudNavGroup>
                <MudNavGroup Title="APPLICATION" Icon="fa fa-pencil-square" Expanded="false">
                    <MudNavLink Href="/SubmittedApplicationPage" Icon="fa fa-plus-circle">NEWLY SUBMITTED</MudNavLink>
                    <MudNavLink Href="/InterviewApplicationPage" Icon="fa fa-question-circle">ORAL INTERVIEWS</MudNavLink>
                    <MudNavLink Href="/FinalApplicationAssessmentPage" Icon="fa fa-list-alt">FINAL REVIEW</MudNavLink>
                </MudNavGroup>
                <MudNavGroup Title="EMPLOYEE" Icon="fa fa-user" Expanded="false">
                    <MudNavGroup Title="PERFORMANCE APPRAISAL" Icon="fa fa-weibo" Expanded="false">
                        @if(hoddetail != null)
                        {
                            <MudNavLink Href="/BscPerspectivesPage" Icon="fa fa-free-code-camp">SET PERSPECTIVE TOTAL WEIGHT</MudNavLink>
                        }
                        
                        <MudNavLink Href="/BSCKeyPerformanceIndicatorsPage" Icon="fa fa-bullseye">SET TARGETS</MudNavLink>
                        <MudNavLink Href="/AppraisalFormPage" Icon="fa fa-street-view">APPRAISAL</MudNavLink>
                    </MudNavGroup>
                    <MudNavGroup Title="EMPLOYEE LEAVE" Icon="fa fa-university" Expanded="false">
                        <MudNavLink Href="/AnnualLeaveRosterPage" Icon="fa fa-calendar">ANNUAL LEAVE ROASTER</MudNavLink>
                        <MudNavLink Href="/EmployeeLeaveRequestPage" Icon="fa fa-pencil-square-o">LEAVE REQUEST</MudNavLink>
                    </MudNavGroup>
                    <MudNavGroup Title="LEARNING AND DEVELOPMENT" Icon="fa fa-exchange" Expanded="false">
                        <MudNavLink Href="/AssessmentSurveyPage" Icon="fa fa-assistive-listening-systems">ASSESSMENT SURVEY</MudNavLink>
                        <MudNavGroup Title="CPD" Icon="fa fa-eercast" Expanded="false">
                            <MudNavLink Href="/CPDPage" Icon="fa fa-snowflake-">CPD</MudNavLink>
                            <MudNavLink Href="/CPDSummaryPage" Icon="fa fa-bandcamp">CPD SUMMARY</MudNavLink>
                        </MudNavGroup>
                        <MudNavLink Href="/GeneralInternalPage" Icon="fa fa-certificate">TRAINING PLAN</MudNavLink>
                        <MudNavLink Href="/SubscriptionPage" Icon="fa fa-bolt">SUBSCRIPTION</MudNavLink>
                        <MudNavLink Href="/TrainingEvaluationFormPage" Icon="fa fa-bomb">TRAINING EVALUATION</MudNavLink>
                    </MudNavGroup>
                </MudNavGroup>

                <MudNavGroup Title="REPORTS" Icon="fa fa-file-excel-o" Expanded="false">
                    <MudNavLink Href="/AppraisalReport" Icon="fa fa-file-excel-o">APPRAISAL REPORT</MudNavLink>
                    <MudNavLink Href="/LeaveRequestReportPage" Icon="fa fa-file-excel-o">LEAVE REQUEST REPORT</MudNavLink>
                </MudNavGroup>

                <MudNavGroup Title="UTILITIES" Icon="fa fa-cogs" Expanded="false">
                    @*<MudNavLink Href="/PrimaryDataPage" Icon="fa fa-database">PRIMARY DATA </MudNavLink>*@
                    <MudNavGroup Title="MANAGE USERS" Icon="fa fa-users" Expanded="false">
                        @*<MudNavLink Href="/AccountManagementPage" Icon="fa fa-user-plus">ACCOUNT MANAGEMENT</MudNavLink>*@
                        <MudNavLink Href="/PrimaryDataPage" Icon="fa fa-users">PRIMARY DATA</MudNavLink>
                    </MudNavGroup>
                </MudNavGroup>
            }

            else if (Credentials.UserRole.Contains("EDITOR", StringComparison.CurrentCultureIgnoreCase))
            {
                <MudNavGroup Title="EMPLOYEE" Icon="fa fa-user" Expanded="false">
                    <MudNavLink Href="/EmployeeRegistrationNewPage" Icon="fa fa-indent">EMPLOYEE REGISTRATION</MudNavLink>
                    <MudNavGroup Title="PERFORMANCE APPRAISAL" Icon="fa fa-weibo" Expanded="false">
                        @if(hoddetail != null)
                        {
                            <MudNavLink Href="/BscPerspectivesPage" Icon="fa fa-free-code-camp">SET PERSPECTIVE TOTAL WEIGHT</MudNavLink>
                        }
                        <MudNavLink Href="/BSCKeyPerformanceIndicatorsPage" Icon="fa fa-bullseye">SET TARGETS</MudNavLink>
                        <MudNavLink Href="/AppraisalFormPage" Icon="fa fa-street-view">APPRAISAL</MudNavLink>
                    </MudNavGroup>
                    <MudNavGroup Title="EMPLOYEE LEAVE" Icon="fa fa-university" Expanded="false">
                        <MudNavLink Href="/AnnualLeaveRosterPage" Icon="fa fa-calendar">ANNUAL LEAVE ROASTER</MudNavLink>
                        <MudNavLink Href="/EmployeeLeaveRequestPage" Icon="fa fa-pencil-square-o">LEAVE REQUEST</MudNavLink>
                    </MudNavGroup>
                    <MudNavGroup Title="LEARNING AND DEVELOPMENT" Icon="fa fa-exchange" Expanded="false">
                        <MudNavLink Href="/AssessmentSurveyPage" Icon="fa fa-assistive-listening-systems">ASSESSMENT SURVEY</MudNavLink>
                        <MudNavGroup Title="CPD" Icon="fa fa-eercast" Expanded="false">
                            <MudNavLink Href="/CPDPage" Icon="fa fa-snowflake-">CPD</MudNavLink>
                            <MudNavLink Href="/CPDSummaryPage" Icon="fa fa-bandcamp">CPD SUMMARY</MudNavLink>
                        </MudNavGroup>
                        <MudNavLink Href="/GeneralInternalPage" Icon="fa fa-certificate">TRAINING PLAN</MudNavLink>
                        <MudNavLink Href="/SubscriptionPage" Icon="fa fa-bolt">SUBSCRIPTION</MudNavLink>
                        <MudNavLink Href="/TrainingEvaluationFormPage" Icon="fa fa-bomb">TRAINING EVALUATION</MudNavLink>
                    </MudNavGroup>
                </MudNavGroup>

                <MudNavGroup Title="REPORTS" Icon="fa fa-file-excel-o" Expanded="false">
                    <MudNavLink Href="/AppraisalReport" Icon="fa fa-file-excel-o">APPRAISAL REPORT</MudNavLink>
                    <MudNavLink Href="/LeaveRequestReportPage" Icon="fa fa-file-excel-o">LEAVE REQUEST REPORT</MudNavLink>
                </MudNavGroup>
                
            }

            else if (Credentials.UserRole.Contains("OFFICER", StringComparison.CurrentCultureIgnoreCase))
            {
                <MudNavGroup Title="EMPLOYEE" Icon="fa fa-user" Expanded="false">
                    <MudNavGroup Title="PERFORMANCE APPRAISAL" Icon="fa fa-weibo" Expanded="false">
                        @if(hoddetail != null)
                        {
                            <MudNavLink Href="/BscPerspectivesPage" Icon="fa fa-free-code-camp">SET PERSPECTIVE TOTAL WEIGHT</MudNavLink>
                        }
                        <MudNavLink Href="/BSCKeyPerformanceIndicatorsPage" Icon="fa fa-bullseye">SET TARGETS</MudNavLink>
                        <MudNavLink Href="/AppraisalFormPage" Icon="fa fa-street-view">APPRAISAL</MudNavLink>
                    </MudNavGroup>
                    <MudNavGroup Title="EMPLOYEE LEAVE" Icon="fa fa-university" Expanded="false">
                        <MudNavLink Href="/AnnualLeaveRosterPage" Icon="fa fa-calendar">ANNUAL LEAVE ROASTER</MudNavLink>
                        <MudNavLink Href="/EmployeeLeaveRequestPage" Icon="fa fa-pencil-square-o">LEAVE REQUEST</MudNavLink>
                    </MudNavGroup>
                    <MudNavGroup Title="LEARNING AND DEVELOPMENT" Icon="fa fa-exchange" Expanded="false">
                        <MudNavLink Href="/AssessmentSurveyPage" Icon="fa fa-assistive-listening-systems">ASSESSMENT SURVEY</MudNavLink>
                        <MudNavGroup Title="CPD" Icon="fa fa-eercast" Expanded="false">
                            <MudNavLink Href="/CPDPage" Icon="fa fa-snowflake-">CPD</MudNavLink>
                            <MudNavLink Href="/CPDSummaryPage" Icon="fa fa-bandcamp">CPD SUMMARY</MudNavLink>
                        </MudNavGroup>
                        @*<MudNavLink Href="/GeneralInternalPage" Icon="fa fa-certificate">TRAINING PLAN</MudNavLink>
                        <MudNavLink Href="/SubscriptionPage" Icon="fa fa-bolt">SUBSCRIPTION</MudNavLink>*@
                        <MudNavLink Href="/TrainingEvaluationFormPage" Icon="fa fa-bomb">TRAINING EVALUATION</MudNavLink>
                    </MudNavGroup>
                </MudNavGroup>

                <MudNavGroup Title="REPORTS" Icon="fa fa-file-excel-o" Expanded="false">
                    <MudNavLink Href="/AppraisalReport" Icon="fa fa-file-excel-o">APPRAISAL REPORT</MudNavLink>
                    <MudNavLink Href="/LeaveRequestReportPage" Icon="fa fa-file-excel-o">LEAVE REQUEST REPORT</MudNavLink>
                </MudNavGroup>
            }

            else if (Credentials.UserRole.Contains("NON-STAFF", StringComparison.CurrentCultureIgnoreCase))
            {
                <MudNavGroup Title="EMPLOYEE PROFILE" Icon="fa fa-user-md" Expanded="false">
                    <MudNavGroup Title="PROFILE" Icon="fa fa-user" Expanded="false">
                        <MudNavLink Href="/NonStaffProfilePage" Icon="fa fa-info-circle">USER PROFILE</MudNavLink>
                        @*<MudNavLink Href="/AppraisalFormPage" Icon="fa fa-street-view">APPRAISAL</MudNavLink>*@
                    </MudNavGroup>
                </MudNavGroup>
            }
            }
            <MudNavGroup Title="@Credentials.AccountHolderName.ToUpper()" Icon="fa fa-user" Expanded="false">
                <MudNavLink Href="/ChangePasswordPage" Icon="fa fa-key">CHANGE PASSWORD</MudNavLink>
                @*<MudNavLink Href="/" Icon="fa fa-sign-out">LOG OUT</MudNavLink>*@
            </MudNavGroup>
        }
    </MudNavMenu>
</MudDrawer>

@code {
    [Parameter]
    public bool SideBarOpen { get; set; } 
    LoginResultModel? Credentials { get; set; }

    List<ADepartmentDto>? DepartmentsData { get; set; }
    List<ViewUserManagement>? SystemUsersData { get; set; }

    protected async override void OnInitialized()
    {
        await base.OnInitializedAsync();
        Credentials = await AuthService.GetUserCredentials();
        JsonSerializerOptions _options = new JsonSerializerOptions { PropertyNameCaseInsensitive = true };

        List<Task> t = new List<Task>();
        t.Add(Task.Run(async () =>
        {
            var responsedepartment = await Http.GetAsync($"Utilities/GetDepartment");
            if (responsedepartment.IsSuccessStatusCode)
            {
                var contentdepartment = await responsedepartment.Content.ReadAsStringAsync();
                DepartmentsData = JsonSerializer.Deserialize<List<ADepartmentDto>>(contentdepartment, _options);
            }
        }));

        SystemUsersData = await AuthService.GetSystemUsers();
    }
}
